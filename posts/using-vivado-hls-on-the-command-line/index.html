<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="map[name:Ben Marshall]">
<meta name="description"
    content="Introduction
Xilinx&amp;rsquo;s High Level Synthesis package, Vivado HLS, is an excellent tool for rapidly developing complex IP cores for FPGA designs. A relatively simple GUI and some reasonable support documents mean anybody can jump in and get started with the tool. However, more advanced users or simply those who have worked with the tool for professional FPGA development for just a few weeks will start to realise the limitations of the GUI." />
<meta name="keywords" content="homepage, blog, electronics, fpga, development, programming, mountain biking" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="benmarshall.co.uk/posts/using-vivado-hls-on-the-command-line/" />


<title>
    
    Using Vivado HLS on the Command Line :: Ben Marshall 
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/benmarshall.co.uk/main.min.7bfbbe12786fa0ded4b4c0d792cbb36a5bd0bdb0b856dde57aa7b1f6fe0f2b87.css">



<link rel="apple-touch-icon" sizes="180x180" href="/benmarshall.co.uk/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/benmarshall.co.uk/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/benmarshall.co.uk/favicon-16x16.png">
<link rel="manifest" href="/benmarshall.co.uk/site.webmanifest">
<link rel="mask-icon" href="/benmarshall.co.uk/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/benmarshall.co.uk/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="Using Vivado HLS on the Command Line">
<meta itemprop="description" content="Introduction
Xilinx&rsquo;s High Level Synthesis package, Vivado HLS, is an excellent tool for rapidly developing complex IP cores for FPGA designs. A relatively simple GUI and some reasonable support documents mean anybody can jump in and get started with the tool. However, more advanced users or simply those who have worked with the tool for professional FPGA development for just a few weeks will start to realise the limitations of the GUI.">


<meta itemprop="datePublished" content="2017-06-14T02:39:04&#43;00:00" />
<meta itemprop="dateModified" content="2017-06-14T02:39:04&#43;00:00" />
<meta itemprop="wordCount" content="1630">



<meta itemprop="keywords" content="fpga,xilinx,hls,vivado," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="benmarshall.co.uk"/>

<meta name="twitter:title" content="Using Vivado HLS on the Command Line"/>
<meta name="twitter:description" content="Introduction
Xilinx&rsquo;s High Level Synthesis package, Vivado HLS, is an excellent tool for rapidly developing complex IP cores for FPGA designs. A relatively simple GUI and some reasonable support documents mean anybody can jump in and get started with the tool. However, more advanced users or simply those who have worked with the tool for professional FPGA development for just a few weeks will start to realise the limitations of the GUI."/>



<meta property="article:section" content="posts" />

<meta property="article:published_time" content="2017-06-14 02:39:04 &#43;0000 &#43;0000" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$cd /home/</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="benmarshall.co.uk/benmarshall.co.uk/about">About</a></li><li><a href="benmarshall.co.uk/benmarshall.co.uk/posts">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>8 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title"><a href="benmarshall.co.uk/posts/using-vivado-hls-on-the-command-line/">Using Vivado HLS on the Command Line</a></h1>

            

            <div class="post-content">
                <p><strong>Introduction</strong><br />
Xilinx&rsquo;s High Level Synthesis package, Vivado HLS, is an excellent tool for rapidly developing complex IP cores for FPGA designs. A relatively simple GUI and some reasonable support documents mean anybody can jump in and get started with the tool. However, more advanced users or simply those who have worked with the tool for professional FPGA development for just a few weeks will start to realise the limitations of the GUI. Fortunately the tool runs on a powerful underlying Tcl base which allows us to move to the command line to unleash the full power and performance of the tool.</p>

<p><strong>Getting Started</strong><br />
Vivado HLS has a <a href="https://www.xilinx.com/video/hardware/using-the-vivado-hls-tcl-interface.html">Tcl interface</a> for scripting or interactive use on the command line. To use it you can just add arguments to the <code>vivado_hls</code> command used to launch the GUI.</p>

<p>To drop into an interactive session use:</p>

<pre><code>vivado_hls -i
</code></pre>

<p>Or to execute a scripted batch run use:</p>

<pre><code>vivado_hls -f script.tcl
</code></pre>

<p>Once in the interactive environment you can use the <code>help</code> command to list all the commands available and drill down into more detailed help info on each individual command.</p>


    <figure class="center" >
        <img src="/images/vivado_hls_help_screenshot.png"  alt="Vivado HLS Help Output"   style="border-radius: 8px;"  />

        
            <figcaption class="left"  style="color: gray;" >Vivado HLS Help Output</figcaption>
        
    </figure>




    <figure class="center" >
        <img src="/images/vivado_hls_help_screenshot.png"  alt="Vivado HLS Help Output"   style="border-radius: 8px;"  />

        
            <figcaption class="left"  style="color: gray;" >Vivado HLS Help Output</figcaption>
        
    </figure>



<p>For most simple projects the interactive workflow would look very familiar:</p>

<ul>
<li>Open a new/existing project.</li>
<li>Open a new/existing solution.</li>
<li>Define a device.</li>
<li>Define some source files.</li>
<li>Specify a top level function for synthesis.</li>
<li>Optionally, define some directives.</li>
<li>Execute one or more of the build phases (c simulation, synthesis, cosim, etc).</li>
</ul>

<p>And then probably iterate around modifying your source/directives and running builds.</p>

<p>Once you have an optimised solution with a build process you are happy with then you can add the commands you need into a Tcl script and move to a scripted build process.</p>

<p><strong>Performance</strong><br />
One of the big advantages of working on the command line is the gain in performance of the tool. The underlying HLS processes are free to run at improved speeds because fewer overheads are required to maintain the GUI, open and close reports as they are generated and replaced, and capture and present every log message as it happens. Beyond raw processing speed I would also suggest that once adapted to working with the tool&rsquo;s command line environment then the reduction in time spent clicking around in what is often (at least on Linux) a frustratingly laggy GUI, also offers a significant improvement in productivity!</p>

<p>To explore these claims in a better way than just collecting anecdotal evidence I put together a rather un-scientific test to compare the execution times of the 3 most common HLS build processes: C simulation, C synthesis and cosimulation.</p>

<p>The test design used was a quickly knocked together floating point implementation of a sin function which uses a Taylor Series approximation. Xilinx offers a sin/cos function as part of the HLS math libraries but writing one out offered the chance to compare build performance at a couple of different stages of the design process. I used a basic stopwatch test to time the execution of the 3 build stages first using the GUI and then using a Tcl script to invoke the equivalent command. The stopwatch was started when I clicked the last button in the GUI before the process starts (which was the dialog box&rsquo;s ok button for both C sim and cosim) or when I hit return after issuing the <code>vivado_hls -f script.tcl</code> command. The stopwatch was stopped as soon as the final line of the process was printed. I gave each tool 3 runs of each build stage to generate an average. Raw data for the results can be <a href="https://github.com/benjmarshall/hls_scratchpad/blob/master/hls_cmd_line_testing/perf_results.md">here</a>.</p>

<table>
<thead>
<tr>
<th></th>
<th align="right">Partially Optimised Results</th>
<th align="right"></th>
<th align="right">Fully Optimised Results</th>
<th align="right"></th>
</tr>
</thead>

<tbody>
<tr>
<td></td>
<td align="right">Command Line (s)</td>
<td align="right">HLS GUI (s)</td>
<td align="right">Command Line (s)</td>
<td align="right">HLS GUI (s)</td>
</tr>

<tr>
<td>C Simulation</td>
<td align="right">2.65</td>
<td align="right">4.50</td>
<td align="right">2.52</td>
<td align="right">4.56</td>
</tr>

<tr>
<td>C Synthesis</td>
<td align="right">7.51</td>
<td align="right">11.59</td>
<td align="right">8.06</td>
<td align="right">11.22</td>
</tr>

<tr>
<td>Cosimulation</td>
<td align="right">120.79</td>
<td align="right">1305.41</td>
<td align="right">114.92</td>
<td align="right">116.37</td>
</tr>
</tbody>
</table>

<p><em>HLS Execution Times</em></p>

<p>It should be reasonably obvious that the general trend of these results backs up my claim of better raw tool performance from the command line interface. What&rsquo;s really startling is the cosimulation results for the partially optimized design; a nearly 10x difference just by not using the GUI. This appears to be down to the level of output from the simulator and is something I&rsquo;ve noticed time and time again working with HLS. If your HDL simulation, for whatever reason, outputs a lot of INFOs or WARNINGs (which is very common with generated code) then the HLS GUI seems to grind almost to a halt. In fact, whilst generating that particular group of results I had several full hangs of the cosimulation process. Anecdotal evidence would suggest that performing the same simulations using the Tcl interface has never shown this to cause the same issues, something it now looks like I can back up with an example.</p>

<p>The code used for this experiment is on [Github](&ldquo;<a href="https://github.com/benjmarshall/hls_scratchpad/tree/master/hls_cmd_line_testing&quot;">https://github.com/benjmarshall/hls_scratchpad/tree/master/hls_cmd_line_testing&quot;</a>) along with the full solution folders for the fully optimised design (I&rsquo;ve left some comments in the code if you want to manually roll back to the &lsquo;partially optimised&rsquo; version). This is a small design suitable for a good basic test, but in my experience the same trend holds true (and gets worse for the GUI) as a design becomes more complex and the build/simulation times increase.</p>

<p><strong>Source Control</strong><br />
Not much information exists on how to manage Vivado HLS projects under source control. Xilinx have tried to disseminate some information about the Vivado approach to revision control, but this focuses on the main Vivado tool and how IP cores are managed once they exist with the IP catalog. How do we manage the source for a Vivado HLS project?</p>

<p>One of the big issues with managing Vivado HLS projects is the amount of files found within a typical project directory. Most of these are generated by HLS. In fact, only the raw source code files are not generated by the tool in some way. As a general rule of thumb I would suggest it is good practice to avoid putting generated files under source control. However, the current status of the project: which build phases have been run, the source file locations, report locations etc, are all wrapped up in some generated &lsquo;project files&rsquo;. In order to avoid re-creating the entire project structure each time we want to &lsquo;check in&rsquo; or &lsquo;commit&rsquo; some source changes we would have to store these generated files with our source code. This creates some rather large commits to your source control tool, and will lead to a lot of file deletions, creations, and replacements on every subsequent commit. Messy!</p>

<p>Taking the GUI out of the equation and moving to command line driven development approach eliminates almost all of these concerns. If a Tcl script is used to control the build procedure then everything to be placed under source control is plain text and exclusively user managed. The Tcl script defines everything needed: the project name, source files, top level function, device, clocks, build procedure etc. If we simply store the raw source code and a single Tcl script then we know, regardless of which project we are pulling (or building, or anything else), that we can re-create the previous build results by executing:</p>

<pre><code>vivado_hls -f script.tcl
</code></pre>

<p>Simple!</p>

<p><strong>Drawbacks</strong><br />
As with everything in life, not everything about switching to the Vivado HLS Tcl interface is a positive. Firstly you lose the GUI, it may seem obvious but it&rsquo;s worth talking about some of the more interesting drawbacks this has. We lose access to the code highlighting and tooltips which can aid development, you know that red squiggle that means you typed a function name in wrong, or you haven&rsquo;t included the correct header file. You lose the ability to easily explore the built in HLS classes and functions by ctrl-clicking on types or function names. You also lose the ability to use the dataflow and analysis view, which can at times prove extremely useful for optimising a design.</p>

<p>The second major item on the drawbacks list is the Tcl interface itself; it&rsquo;s quite clunky. The commands aren&rsquo;t the easiest to remember, they aren&rsquo;t that short, and many of them have arguments that you end up wishing would be on by default to avoid having to type them out every damn time!</p>

<p><strong>Summary</strong><br />
In summary, the Vivado HLS Tcl interface offers a performance increase for demanding builds, and I would argue that on balance avoiding the laggy (and frequently buggy) GUI speeds up design iteration. Embracing a command line driven approach naturally leads to an easy scripted build process and a much easier time with source control. I have personally used both SVN and GIT for professional and personal projects using a primarily command line driven design process.</p>

<p>Avoiding the GUI outright does introduce some major cons though, we lose some of the useful code editing features and the neat optimisation tools. The obvious conclusion is that a productive design process should take a balanced approach. I often start development of a HLS project in the GUI as I architect my code and iterate over the first few C simulations to ensure correct functionality. However, as the design progresses towards the optimisation phase and I start iterating through C synthesis and cosimulations rapidly, I move almost exclusively to the command line using a Tcl script to drive the tool. The exception to this rule is when I need access to the optimisations views, fortunately launching the GUI and opening the generated project is easy and provides access to all those useful features without removing the benefits of returning to the command line for the next build.</p>

<p>I&rsquo;ll follow this post up soon with a more detailed run through of my current design process for working with Vivado HLS. Until then, give the HLS Tcl interface a go if you&rsquo;re not using it already, you won&rsquo;t regret it!</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="benmarshall.co.uk/tags/fpga">fpga</a></span><span class="tag"><a href="benmarshall.co.uk/tags/xilinx">xilinx</a></span><span class="tag"><a href="benmarshall.co.uk/tags/hls">hls</a></span><span class="tag"><a href="benmarshall.co.uk/tags/vivado">vivado</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1630 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2017-06-14 03:39 &#43;0100</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="benmarshall.co.uk/posts/introducing-hlsclt-a-vivado-hls-helper-tool/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Introducing hlsclt: a Vivado HLS Helper Tool</span>
                            </a>
                        </span>
                    

                    
                </div>
            </div>
        

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2019</span>
            
                <span><a href="benmarshall.co.uk">Ben Marshall</a></span>
            
            <span></span>
            <span> <a href="benmarshall.co.uk/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/benmarshall.co.uk/bundle.min.4c3fb12a087ceed4a52cb5d57068a9795c7069617a01ca70f788052ad66e1791779e6c72686e1dc0ca13dc03b0203204b6566bb0dd1ee80de2b7ff4d8fe53db2.js" integrity="sha512-TD&#43;xKgh87tSlLLXVcGipeVxwaWF6Acpw94gFKtZuF5F3nmxyaG4dwMoT3AOwIDIEtlZrsN0e6A3it/9Nj&#43;U9sg=="></script>



    </body>
</html>
